<?xml version="1.0" encoding="UTF-8"?>

<script xmlns="http://dtf.org/v1" name="stream">
    <info>
        <author>
            <name>Rodney Gomes</name>
            <email>rlgomes@yahoo-inc.com</email>
        </author>
        <description>DTF unit test for streaming feature.</description>
    </info>
    
    <local>
        <createstorage id="INPUT" path="${dtf.xml.path}/input"/>
        <createstorage id="OUTPUT" path="${dtf.xml.path}/output"/>
        
        <loadproperties uri="storage://INPUT/ut.properties"/>
    </local>

    <log>Validate we always generate the same message for the same signature.</log>
    <createrange name="seeds" value="${dtf.timestamp},ABRACADABRA"/>    
    <for property="type" range="random,repeat"> 
        <property name="seed" value="${seeds}" overwrite="true"/>
        
	    <for property="i" range="1..${iterations.small}">    
		    <property name="data1"
		              value="${dtf.stream(${type},32,${seed})}" 
		              overwrite="true"/>
		
		    <property name="data2"
		              value="${dtf.stream(${type},32,${seed})}" 
		              overwrite="true"/>
                      
            <if>
                <neq op1="${data1}" op2="${data2}"/>
                <then>
                    <log>${data1} != ${data2}</log>
                    <fail message="Messages differ!"/>
                </then>
            </if>
	    </for> 
    </for>
   
</script> 