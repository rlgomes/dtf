<?xml version="1.0" encoding="UTF-8"?>
<script xmlns="http://dtf.org/v1" name="recorder_perf">
    <info>
        <author>
            <name>Rodney Gomes</name>
            <email>rlgomes@yahoo-inc.com</email>
        </author>
        <description>DTF recorder limits test.</description>
    </info>
    
    <local>
        <createstorage id="INPUT" path="${dtf.xml.path}/input"/>
        <createstorage id="OUTPUT" path="${dtf.xml.path}/output"/>

        <echo>Recorder Limits Tests</echo>
    </local>

    <local>
        <echo>Generating data...</echo>
        <property name="prop1" value="222222"/>
        <property name="prop2" value="abababababababababababababababa"/>
        <property name="iterations" value="200000"/>
    </local> 
    
	<record type="txt" uri="storage://OUTPUT/recorder1.txt" append="false"> 
        <for property="iteration" range="1..${iterations}">
            <event name="dtf.event">
                <attribute name="value1" value="${iteration}" type="string" length="64"/>
                <attribute name="value2" value="${prop1}" type="string" length="64"/>
                <attribute name="value3" value="${prop2}" type="string" length="64"/>
                <attribute name="value4" value="${iteration}-${prop1}" type="string" length="64"/>
                <attribute name="value5" value="${prop1}${prop1}" type="string" length="64"/>
            </event>
        </for>
    </record>
   
    <event name="cmp">
	    <compare>
		    <query uri="storage://OUTPUT/recorder1.txt" 
		           event="dtf.event"
		           cursor="cursor"/>
		    <validate>
		    	<assert>
                    <and>
	                    <eq op1="${cursor.value2}" op2="${prop1}"/>
	                    <eq op1="${cursor.value3}" op2="${prop2}"/>
                    </and>
                </assert>
		    </validate>
	    </compare> 
   	</event>
   	
   	<event name="imp">
	    <query uri="storage://OUTPUT/recorder1.txt" 
	           event="dtf.event"
	           cursor="cursor"/>
	    <iterate cursor="cursor">
	    	<assert>
                <and>
	                <eq op1="${cursor.value2}" op2="${prop1}"/>
	                <eq op1="${cursor.value3}" op2="${prop2}"/>
                </and>
            </assert>
	    </iterate>
    </event> 
   
    <subtract op1="${imp.stop}" op2="${imp.start}" result="imp.dur"/> 
    <subtract op1="${cmp.stop}" op2="${cmp.start}" result="cmp.dur"/> 

	<log>Using query and iterate tag:  ${imp.dur}ms</log>    
	<log>Using Compare tag:            ${cmp.dur}ms</log>    
</script>
